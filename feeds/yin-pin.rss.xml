<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>兰湾</title><link href="http://st.avros.net/" rel="alternate"></link><link href="http://st.avros.net//feeds/yin-pin.rss.xml" rel="self"></link><id>http://st.avros.net/</id><updated>2015-10-09T00:00:00+08:00</updated><entry><title>在STM32F051上重新实现了SD卡WAVE播放器</title><link href="http://st.avros.net/articles/stm32_sd_waveplayer.html" rel="alternate"></link><published>2015-10-09T00:00:00+08:00</published><author><name>Stavros</name></author><id>tag:st.avros.net,2015-10-09:articles/stm32_sd_waveplayer.html</id><summary type="html">&lt;p&gt;前几年试过用AVR来播放sd卡上的wave文件. (链接: &lt;a href="http://st.avros.net/articles/avr_sd_waveplayer_2.html"&gt;http://st.avros.net/articles/avr_sd_waveplayer_2.html&lt;/a&gt;) 这次改用stm32f051试了一遍, 28.224M晶振, 1.5倍频到42.336M, 这样48kHz和44.1kHz都可以按准确的比特率播放了.&lt;/p&gt;
&lt;p&gt;DAC用的是PT8211, 软件方式写I2S数据, 结果还是有爆音. 大概I2S对时序要求比较严格, 有空了改成硬件I2S再试试. &lt;/p&gt;
&lt;p&gt;顺便在这块板上试验了几块TFT LCD屏. SPI接口的TFT还是太慢, 清屏等操作时能看清刷屏过程. 并口的好用, 就是布线麻烦了点.&lt;/p&gt;</summary></entry><entry><title>R-2R SD卡WAVE播放器</title><link href="http://st.avros.net/articles/avr_sd_waveplayer_2.html" rel="alternate"></link><published>2013-07-14T00:00:00+08:00</published><author><name>Stavros</name></author><id>tag:st.avros.net,2013-07-14:articles/avr_sd_waveplayer_2.html</id><summary type="html">&lt;p&gt;用ATMega8, 16.9344M晶振, 14位r-2r作为DAC, 实现了流畅播放16位 44.1kbps单声道wav.  双声道没试, 估计超点频应该差不多了. &lt;/p&gt;
&lt;p&gt;这东西有点说来话长. 最早是amobbs的马潮老师出了个题目, 8*8的LED屏, 中间四个常亮, 最外圈亮一个转圈跑. 那会儿我正好有块点阵屏闲着, 就焊了一块板, 从开始写程序计算, 39分钟解决了.  &lt;/p&gt;
&lt;p&gt;讨论过程中师弟TwoPerson把这位马潮老师惹怒了. 于是他放出狂言, 原文如下:  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如果不服, 可以再次比试. 你在北大找5个学生, 组成一个小组. 用m16加一片lm324, 设计一个读取sd卡上wave文件, 并播放的wave播放器, 看谁做的好.  给你们一个月的时间, 下个学期开学我到北大找你, 比试实物效果. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在我这个外行看来, 这个题目也就是一个人两三天到一周左右的工作量, 至于五个人搞一个月么? 不过后来事情一多也就把这回事忘了.  &lt;/p&gt;
&lt;p&gt;今年1月份想起来了, 于是动手开干. 用8位PWM先试了一次, 从学习SD协议、实现FAT开始, 焊接、写程序到调试全算上, 用了两个晚上、周六全天加周日半天, 基本完事. 当然8位PWM的音质有点惨不忍睹……&lt;/p&gt;
&lt;p&gt;这次改用r-2r ladder来实现16位输出, 三个晚上加两个白天, 完事了. 算上之前的两晚上和一个半白天, 还算符合我之前“一个人一周工作量”的估计吧. m8的io稍微有点不够用了, 凑了14位出来, 倒是也差不多了. 音质么我觉得还不错. &lt;/p&gt;
&lt;p&gt;原理图:&lt;/p&gt;
&lt;p&gt;&lt;a href="/images/avr_sd_waveplayer_2.png"&gt;&lt;img src="/images/avr_sd_waveplayer_2.png" width="500" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;程序:
&lt;a href="/files/avr_sd_waveplayer_2_src.7z"&gt;avr_sd_waveplayer_2_src.7z&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;马老师那边啥反应? 猜也猜得出, 他在精神上永远都能胜利, 我实在不想引用那个“永远不要试图去战胜一个纯xx, 他会把你的智商拖到跟他一样的水平, 然后用他丰富的经验打败你. ”的段子, 不过还是把链接贴过来好了. &lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.amobbs.com/thread-5535140-1-1.html" target="_blank"&gt;http://www.amobbs.com/thread-5535140-1-1.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;马老师喷了几大篇以后不知出于一种什么心理, 封贴了, 对此咱就不作啥评论了, 呵呵.&lt;/p&gt;</summary></entry><entry><title>USB电子管声卡</title><link href="http://st.avros.net/articles/usb_dac_tube.html" rel="alternate"></link><published>2013-05-23T00:00:00+08:00</published><author><name>Stavros</name></author><id>tag:st.avros.net,2013-05-23:articles/usb_dac_tube.html</id><summary type="html">&lt;p&gt;这次是PCM2702+NE5534+2P2的组合——以USB的供电能力最多只能带动2P2了. &lt;/p&gt;
&lt;p&gt;&lt;a href="/images/usb_dac_tube.jpg" title="电路图"&gt;&lt;img src="/images/usb_dac_tube.jpg" width="500px" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;相当小巧, PCB面积比公交卡还小, 不过输出变压器没包括在内. &lt;/p&gt;
&lt;p&gt;电路图如下, PCM2702输出的音频信号由NE5534反相放大后推动2P2. &lt;/p&gt;
&lt;p&gt;&lt;a href="/images/usb_dac_tube.png" title="电路图"&gt;&lt;img src="/images/usb_dac_tube.png" width="500px" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;主要的麻烦是供电, 一只2P2需要60V屏压、1.2或2.4V灯丝、-3.5V栅偏压. 60V高压用LM2577升压得到; 这里用灯丝串联电阻R14上的压降来代替栅偏压, 于是可以省下一组供电. 此外NE5534的最高供电电压是±22V, 这里给它提供了一路30V电压. 这块小板子上供电占了大概1/3的面积. &lt;/p&gt;
&lt;p&gt;效果么...... 只能说还凑合吧, 主要是音量太小了, 2P2的输出功率只有100mW. 下次试试两只2P2推挽的效果吧. &lt;/p&gt;</summary></entry><entry><title>AVR SD WAVE播放器</title><link href="http://st.avros.net/articles/avr_sd_waveplayer.html" rel="alternate"></link><published>2013-01-17T00:00:00+08:00</published><author><name>Stavros</name></author><id>tag:st.avros.net,2013-01-17:articles/avr_sd_waveplayer.html</id><summary type="html">&lt;p&gt;得从大约两年前说起, 那会儿amobbs的马潮老师出了个题目: 8x8的LED屏, 中间四个常亮, 最外圈亮一个转圈跑. &lt;/p&gt;
&lt;p&gt;这东西没啥难度吧？我正好有块点阵屏闲着, 就焊了一块板, 从开始写程序计算, 39分钟解决了.  &lt;/p&gt;
&lt;p&gt;讨论过程中一师弟(好象是TwoPerson?)大概出口不慎, 把这位马潮老师惹怒了——于是他又出了个题, 原话如下: &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如果不服, 可以再次比试. 你在北大找5个学生, 组成一个小组. 用m16加一片lm324, 设计一个读取sd卡上wave文件, 并播放的wave播放器, 看谁做的好. 给你们一个月的时间, 下个学期开学我到北大找你, 比试实物效果. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;首先声明一下, 本人纯粹是外行, 本科化学, 研究生改物理了, 以上纯属业余爱好. 马老师这题目在我这个外行看来, 也就是一个人两三天到一周左右的工作量, 至于五个人搞一个月么？不过后来事情一多也就把这回事忘了. &lt;/p&gt;
&lt;p&gt;前段时间突然记起来了, 于是动手开干. 电路图太简单就不画了. 觉得没必要上m16, 于是用了一片m8, 硬件SPI接SD卡, 8位PWM输出, 用一片TL061搭成低通滤波, 后面一只8050缓冲接喇叭. 从学习SD协议、实现FAT开始, 焊接、写程序到调试全算上, 用了两个晚上、周六全天加周日半天, 基本完事. 当然8位PWM的音质有点惨不忍睹……&lt;/p&gt;
&lt;p&gt;原理图: &lt;/p&gt;
&lt;p&gt;&lt;a href="/images/avr_sd_waveplayer.png" title="电路图"&gt;&lt;img src="/images/avr_sd_waveplayer.png" width="500px" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;程序:&lt;/p&gt;
&lt;p&gt;&lt;a href="/files/avr_sd_waveplayer_src.7z"&gt;src.7z&lt;/a&gt;&lt;/p&gt;</summary></entry><entry><title>CM102音箱</title><link href="http://st.avros.net/articles/cm102_speaker.html" rel="alternate"></link><published>2011-02-13T00:00:00+08:00</published><author><name>Stavros</name></author><id>tag:st.avros.net,2011-02-13:articles/cm102_speaker.html</id><summary type="html">&lt;p&gt;CM102是台湾C-Media公司的USB声卡芯片. 跟著名的PCM270x相比, 好处就是: 便宜、有DIP封装, 当然效果没法比了. 电路图如下: &lt;/p&gt;
&lt;p&gt;&lt;a href="/images/cm102_speaker.png" title="电路图"&gt;&lt;img src="/images/cm102_speaker.png" width="500px" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;结果是有很大的不规则的噪声...开始以为是VBUS直供TDA2822的原因, 于是让VBUS过了1117-3.3再供TDA2822, 结果仍然噪声很大；全换成用电池供电, 仍然噪声很大；干脆断开TDA2822, 把耳机接到CM102的输出上, 噪声没了. 看样子是买到山寨2822了, 下次用TEA2025重做吧, 或者直接改用LM4890. &lt;/p&gt;
&lt;p&gt;ps. C-Media的网站怎么可以这么2呢... 手里CM102的datasheet旧了, 而且几个图都巨模糊, 想找个新的看看, 上CM官网一找, 倒是有, 但是不支持google浏览器；换ie, 发现让注册用户；注册了用户, 下载了datasheet一看, 几个图还是模糊的. 这家的东西似乎卖得还不错, 比如当年的CMI8738. &lt;/p&gt;</summary></entry></feed>